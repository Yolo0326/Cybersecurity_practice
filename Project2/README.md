# 基于离散余弦变换（DCT）的图片水印嵌入与提取

## DCT介绍
DCT是离散余弦变换，它用一系列不同频率的余弦波的加权和（系数）来表示原始信号，进行DCT变换，将会把信号的大多数能量集中于频域的一个小范围内，即低频。纹理信息一般集中在高频，而低频包含又较多平滑的信息，人眼对平滑区域的变化较中高频的纹理信息更敏感，选择中频系数嵌入是最合适的。  
### 一、DCT的优势
1.相比于DFT，DCT只使用实数的余弦函数作为基函数，而DFT使用复数（包含余弦和正弦分量）。因此DCT在计算上更高效，并且对于具有强相关性的实数信号，其能量集中特性通常比DFT更好。  
2.DCT能将原本在空间/时间上高度相关的信号样本，转换成在变换域中相关性很弱的系数，后续处理更有效。  
### 二、DCT的应用
DCT在图像和视频压缩，音频压缩，信号处理，数字水印等方面都有非常重要的应用

## 实验原理
### 一、水印嵌入
#### 1.初始化与参数设置
在DCT_Embed类的构造函数__init__中，获取待嵌入水印的图像和水印图像的尺寸信息，进行尺寸合法性校验，确保水印图像尺寸不大于背景图像尺寸按设定块大小划分后的尺寸。同时初始化一些关键参数，如分块大小block_size（默认值为8）、嵌入强度系数alpha，以及用于嵌入时区分水印值（0 或 1）的两个随机向量k1和k2。注意根据分块大小block_size的值，水印图片的尺寸为待嵌入水印的图像的1/block_size。

#### 2.图像分块与DCT变换
将输入的背景图像按照设定的块大小（如 8×8）进行分块。对于划分好的每个块，使用cv2.dct函数进行离散余弦变换，将图像从空间域转换到频域，得到对应块的DCT系数矩阵，最终形成一个包含所有分块DCT系数的多维数组，用于后续嵌入水印操作。

#### 3.水印嵌入
确保输入的水印图像是经过二值归一化处理的（像素值仅为 0 或 1）。遍历水印图像的每个像素位置（对应到背景图像分块的位置），根据当前水印像素值是0还是1，选择对应的随机向量k1或k2，将水印信息嵌入到对应块的 DCT 系数中。具体是修改每个块的最后一列（特定频率分量）的DCT系数，通过加上与嵌入强度系数alpha、所选随机向量相关的值来实现水印嵌入。

#### 4.逆DCT变换与图像合成
对嵌入水印后的DCT系数矩阵进行逆离散余弦变换（cv2.idct），将频域数据转换回空间域。依次对每个块进行逆变换后，再将这些块按照原来的位置拼接起来，得到嵌入水印后的单通道图像，对于彩色图像则是分别处理每个通道后再合并通道，最终得到嵌入水印后的彩色图像。
### 二、水印提取
#### 1.图像分块与DCT变换
对嵌入水印后的合成图像，按照与嵌入时相同的块大小，使用dct_blkproc方法进行分块并进行DCT变换，获取各块的DCT系数矩阵，以便从中提取水印信息。

#### 2.水印提取
遍历与原始水印图像尺寸对应的各块位置，提取每个块最后一列（嵌入水印时所使用的频率分量）的DCT系数组成向量p。通过计算向量p与嵌入时使用的两个随机向量k1和k2的相关性（利用corr2函数计算相关系数），根据相关性大小来判断当前块位置对应的水印值是 0 还是 1。相关性更大的一方对应的水印值（1 对应k1，0 对应k2）作为提取出的水印像素值，遍历完所有对应位置后，得到完整的提取水印图像，对于彩色图像的各通道提取结果再进行合并等处理。
